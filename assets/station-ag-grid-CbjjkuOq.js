import{at as B,u as F,j as r,B as H,g as L,aB as N}from"./chakra-DA8f5sL-.js";import{d as P,u as f,e as g,aT as y,g as z,aa as G,a9 as W,ab as Z,aU as O}from"./index-tQsjEiNT.js";import{u as _,r as o}from"./react-B326QF9K.js";import{g as $,R as U}from"./app-router-D8C5TK1k.js";import{A as q}from"./ag-grid-react-Dw-GanXl.js";import"./param-selector-weTTzV80.js";import"./ag-grid-community--YnWG4s9.js";var J=function(d){var l=d.children,t=B().colorMode,c=F("RmgAgGrid");return r.jsx(H,{className:t==="light"?"ag-theme-alpine":"ag-theme-alpine-dark",sx:c,children:l})};function K(d){const{lineNumber:l,stationNumber:t,lineColour:c}=d,i={h:"24px",position:"relative",color:"black","&::before":{content:"''",w:"calc(100% + 2px)",h:"26px",position:"absolute",top:"-1px",left:"-1px",bg:"white",borderRadius:"13px"},span:{display:"flex",justifyContent:"center",alignItems:"center",padding:"3px",minWidth:"24px",border:"2px solid",borderColor:c,zIndex:1,"&:first-of-type":{borderRadius:"12px 0 0 12px"},"&:last-of-type":{borderRadius:"0 12px 12px 0",marginLeft:"-2px"}}};return r.jsxs(L,{sx:i,children:[r.jsx("span",{children:l}),r.jsx("span",{children:t})]})}function re(d){const{branchIndex:l}=d,{t,i18n:c}=_(),i=P(),x=f(n=>n.app.sidePanelMode),{style:u,theme:R,stn_list:S,line_num:j,coline:M}=f(n=>n.param),b=f(n=>n.helper.branches),[A,T]=o.useState([]);o.useEffect(()=>{const n=b[l].reduce((e,s)=>["linestart","lineend"].includes(s)?e:[...e,{...S[s],id:s,rowSpan:i($(s,l))}],[]);T(n)},[b,l,S]);const v=o.useMemo(()=>[{headerName:t("StationAgGrid.num"),field:"num",cellRenderer:({value:n})=>r.jsx(K,{lineNumber:j,stationNumber:n,lineColour:R[2]}),pinned:"left",minWidth:110,hide:![g.GZMTR].includes(u)},{headerName:t("Chinese name"),field:"name",valueFormatter:({value:n,data:e})=>n[0]+(u===g.GZMTR&&(e!=null&&e.secondaryName)&&(e!=null&&e.secondaryName[0])?" (".concat(e.secondaryName[0],")"):"")},{headerName:t("English name"),field:"name",cellRenderer:({value:n,data:e})=>r.jsx(U,{text:n[1]+(u===g.GZMTR&&e.secondaryName&&e.secondaryName[1]?" (".concat(e.secondaryName[1],")"):"")}),minWidth:300},{headerName:t("StationAgGrid.interchange"),field:"transfer",cellRenderer:({value:n})=>r.jsx(N,{children:n.groups.map(e=>{var s;return(s=e.lines)!=null?s:[]}).flat().map((e,s)=>{var a,h,w,C;return r.jsx(y,{name:e.name,bg:(h=(a=e.theme)==null?void 0:a[2])!=null?h:"#aaaaaa",fg:(C=(w=e.theme)==null?void 0:w[3])!=null?C:z.white,showShortName:!0},s)})})},{headerName:t("StationAgGrid.coline"),field:"rowSpan",rowSpan:({data:n})=>{var e;return(e=n==null?void 0:n.rowSpan[0])!=null?e:0},cellClassRules:{"rmg-ag-grid--spanned-cell":({value:n})=>n[0]>0},cellRenderer:({value:n})=>{var e,s;return r.jsx(N,{children:(s=(e=M[n[1]])==null?void 0:e.colors)==null?void 0:s.map((a,h)=>r.jsx(y,{name:[a[4],a[5]],bg:a[2],fg:a[3],showShortName:!0},h))})},hide:![g.SHMetro].includes(u)}],[u,R.toString(),c.language]),m=o.useRef(null),p=o.useRef(!1);o.useEffect(()=>{p.current&&m.current&&m.current.api.getSelectedRows().length===1&&x!==G.STATION&&m.current.api.deselectAll()},[p.current,x]);const[k]=o.useState({resizable:!0}),I=o.useCallback(()=>{p.current=!0},[p.current]),D=o.useCallback(({api:n})=>{var s;const e=(s=n.getSelectedRows())==null?void 0:s.map(a=>a.id);console.log("StationAgGrid.handleSelectionChanged():: Row selection changed",e),e!=null&&e.length&&(i(W(G.STATION)),i(Z(e[0])),i(O(void 0)))},[]),E=o.useCallback(({data:n})=>n.id,[]);return r.jsx(J,{children:r.jsx(q,{ref:m,rowData:A,defaultColDef:k,columnDefs:v,getRowId:E,headerHeight:36,rowHeight:36,suppressCellFocus:!0,suppressMovableColumns:!0,suppressRowTransform:!0,rowSelection:"single",onSelectionChanged:D,onGridReady:I,debug:!1})})}export{re as default};
